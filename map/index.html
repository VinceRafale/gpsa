<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8 />
	<title>Roster of Practitioners</title>

	<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'/>
	<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
	<script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.css' rel='stylesheet'/>
	<link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.css' rel='stylesheet'/>
	<link href='css/map-style.css' rel='stylesheet'/>
	<script src="js/gpsa-rosters.geojson.js"></script>
</head>
<body>
	<div id='map'>
		<div id="themes-layers" class="layers"></div>
	</div>
	
	<div id='info'></div>

	<script type="text/javascript">
		/*load map - mapbox fundarmexico*/
		var map     = L.mapbox.map('map', 'fundarmexico.zuz69a4i').setView([0,0], 3);
		var markers = new L.LayerGroup();
		
		/*disable scroll and tocuh zoom*/
		map.touchZoom.disable();
		map.scrollWheelZoom.disable();

		/*marker style-options*/
		var geojsonMarkerOptions = {
			radius : 17,
			fillColor: "transparent",
			color: "#a9d7ef",
			weight: 13,
			opacity: 0.7,
			fillOpacity: 0.8
		};

		function draw(value) {
			var theme = parseInt(value);
			
			/*on each marker*/
			function onEachFeature(feature, layer) {
				var feature = feature;
				
				/*search index theme on array [0,1] number of experts for country*/
				var indexof  = jQuery.inArray(theme, feature.properties.themes[0]);
				var indexof2 = jQuery.inArray(theme, feature.properties.themes[1]);
				
				if(indexof != -1 || indexof2 != -1 || theme == 0) {
					var circle = L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], geojsonMarkerOptions);
				   
					/*Listen for individual marker CLICK*/
					circle.on('click',function(e) {
						var info  = '<h2>' + feature.properties.name + '</h2>';
						
						for(i in feature.properties.names) {
							info += '<p class="name-expert"><a href="' + feature.properties.urls[i] + '" title="' + feature.properties.names[i] + '">' + feature.properties.names[i] + '</a></p>';
						}

						document.getElementById('info').innerHTML = info;
					});
					
					/*Listen for individual marker OVER*/
					circle.on('mouseover',function(e) {
						var info  = '<h2>' + feature.properties.name + '</h2>';
						
						for(i in feature.properties.names) {
							info += '<p class="name-expert"><a href="' + feature.properties.urls[i] + '" title="' + feature.properties.names[i] + '">' + feature.properties.names[i] + '</a></p>';
						}

						document.getElementById('info').innerHTML = info;
					});
					
					/*add to group layer*/
					markers.addLayer(circle);
				}
			}

			/*load geojson.js*/
			L.geoJson(geojson, {
				onEachFeature: onEachFeature
			});
		}
		
		/*add layer to map*/
		markers.addTo(map);
		
		/*on each theme set legend*/
		var themes = '<a id="theme-0" data-control="layer">All themes</a>';
		
		for(i in geojson.properties.themes) {
			themes += '<a id="theme-' + geojson.properties.themes[i].id_theme + '" data-control="layer">' + geojson.properties.themes[i].name + '</a>';
		}
		document.getElementById('themes-layers').innerHTML = themes;
		
		$(document).ready (function () {
			$('.layers > a').click(function() {
				$(".layers > a").removeClass('active');
				
				if($(this).hasClass('active')) {
					$(this).removeClass('active');
				} else {
					$(this).addClass('active');
				}
				
				setTheme();
			});
			
			$("#theme-0").click();
		});
		
		function setTheme() {
			markers.clearLayers();
			
			var active = $(".layers > a.active").attr("id");
			
			draw(active.replace("theme-", ""));
		}
	</script>
</body>
</html>
